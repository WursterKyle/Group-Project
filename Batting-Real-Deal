# Batting Statisitcs Extraction

# Act like an expert in Python programming, baseball analytics, and statistics. Also act like an expert in solving business problems in the sports and entertainment industry. You are in the operations of a major league baseball team. You have been presented with a problem by the owners of your major league baseball team on how players' performances change as they age, and what age range typically represents peak performance in various statistical categories. We will use Python to create programs to use baseball data and create it into significant statistical analysis.  Please provide verbose comments so we can understand what is occurring at each line of code. We use Visual Studio Code for writing and executing Python. Make sure the code runs correctly.  You are a master in clean, maintainable, readable, and scalable code. Create a python program that reads in the spreadsheet "C:\Users\kylew\OneDrive\Documents\People.xlsx". The program should begin with searching in the spreadsheet and extracting every player with an MLB debut date from the year 1974 until current day 2024.  Each player is given a "playerID" given in column B.  Debut date is found in in column T, named "debut".  Make sure the dates are made into date format.  Using the selected players, now read in the spreadsheet "C:\Users\kylew\OneDrive\Documents\Batting.xlsx".   This spreadsheet provides the "playerID" and their batting statistics from every year of their career.  With the selected players based on debut date, take each player and print out their age at every year of their career.  Age will be determined by year of play shown in the "Batting.xlsx" spreadsheet in column B labeled "yearID" subtracted by birth date shown in the "People.xlsx" spreadsheet in column C "birthYear".  
First we will calculate each players batting average for each year of their career.  This will be done using column J "H" and dividing that by column H "AB".  Second, calculate On-Base percentage.  On-Base percentage is determined by dividing the total amount of "H" in column J, "BB" in column Q, and "HBP" in column T by the total amount of "AB" in column H, "SF" in column V, "BB" in column Q, and "HBP" in column T.  Then calculate the slugging of each player.  Slugging is calculated by taking “1B” + “2B” times 2, “3B” times 3, and “HR” times 4 and dividing that by “AB”.  “1B” will be calculated by taking “H” minus the total of (2B+3B+HR). “2B” is in column K, “3B” in  column L, “HR” in column M, “H” in column J and “AB” in column H.  Add together the On-Base percentage and the Slugging percentage to get “OPS”.  Then find each players "HR" in column M.  Lastly find each players “SB” found in column “O”.  The program should then print out the playerID, yearID, Age, batting average or “BA”, On-Base percentage plus slugging or “OPS”, SB, and HR.  Use pandas dataframe to format the data in the terminal.  Filter out any players who have less than 200 "AB".  Remove them from the data.

import pandas as pd
from datetime import datetime

# File paths
people_file_path = r'C:\Users\kylew\OneDrive\Documents\People.xlsx'
batting_file_path = r'C:\Users\kylew\OneDrive\Documents\Batting.xlsx'

# Read People.xlsx
people_df = pd.read_excel(people_file_path)

# Convert 'debut' column to datetime
people_df['Debut'] = pd.to_datetime(people_df['debut'], format='%Y-%m-%d')

# Filter players with MLB debut dates from 1974 to current year
selected_players = people_df[(people_df['Debut'].dt.year >= 1974) & (people_df['Debut'].dt.year <= datetime.now().year)]

# Read Batting.xlsx
batting_df = pd.read_excel(batting_file_path)

# Merge selected players with batting data
merged_df = pd.merge(selected_players, batting_df, on='playerID', how='inner')

# Calculate age at every year of their career
merged_df['Age'] = merged_df['yearID'] - merged_df['birthYear']
merged_df['Age'] = merged_df['Age'].astype(int)  # Convert age to integer

# Calculate batting average (BA) for each year
merged_df['BA'] = merged_df['H'] / merged_df['AB']

# Calculate On-Base Percentage (OBP)
# OBP = (H + BB + HBP) / (AB + BB + HBP + SF)
merged_df['OBP'] = (merged_df['H'] + merged_df['BB'] + merged_df['HBP']) / (merged_df['AB'] + merged_df['BB'] + merged_df['HBP'] + merged_df['SF'])

# Calculate Slugging Percentage (SLG)
# SLG = ((1B) + (2B x 2) + (3B x 3) + (HR x 4)) / AB
merged_df['1B'] = merged_df['H'] - (merged_df['2B'] + merged_df['3B'] + merged_df['HR'])
merged_df['SLG'] = (merged_df['1B'] + (merged_df['2B'] * 2) + (merged_df['3B'] * 3) + (merged_df['HR'] * 4)) / merged_df['AB']

# Calculate On-Base Plus Slugging (OPS)
merged_df['OPS'] = merged_df['OBP'] + merged_df['SLG']

# Filter out players with less than 200 AB
filtered_df = merged_df[(merged_df['AB'] >= 200)]

# Print playerID, yearID, Age, BA, OPS, SB, and HR
print("PlayerID  |  YearID  |  Age  |  BA  |  OPS  |  SB  |  HR")
print("----------------------------------------------------------")
for index, row in filtered_df.iterrows():
    print(f"{row['playerID']}  |  {row['yearID']}  |  {row['Age']}  |  {row['BA']:.3f}  |  {row['OPS']:.3f}  |  {int(row['SB'])}  |  {row['HR']}")
